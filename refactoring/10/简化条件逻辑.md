## 10.1 分解条件表达式（Decompose Conditional）

1. 名称

2. 一个简单的速写

```javascript
if (!aDate.isBefore(plan.summerStart) && !aData.isAfter(plan.summerEnd))
    charge = quantity * plan.summerRate;
else
    charge = quantity * plan.regularRate + plan.regularServiceCharge;
```

重构为：

```javascript
if (summer())
    charge = summerCharge();
else
    charge = regularCharge();
```

2. 动机

程序之中，复杂的条件逻辑是最常导致复杂度上升的地点之一。我们可以将它拆分为多个独立的函数，根据每个小块代码的用途，为分解而得的新函数命名，可以突出条件逻辑，更清楚的表明每个分支的作用。

4. 做法

- 对条件判断和每个条件分支分别运用提炼函数手法

5. 范例

```javascript
if (!aDate.isBefore(plan.summerStart) && !aData.isAfter(plan.summerEnd))
    charge = quantity * plan.summerRate;
else
    charge = quantity * plan.regularRate + plan.regularServiceCharge;
```

先吧判断条件提炼到一个独立的函数中

```javascript
if (summer())
    charge = quantity * plan.summerRate;
else
    charge = quantity * plan.regularRate + plan.regularServiceCharge;
function summer(){
    return !aDate.isBefore(plan.summerStart) && !aData.isAfter(plan.summerEnd)
}
```

然后提炼条件判断为真的分支

```javascript
if (summer())
    charge = summerCharge()
else
    charge = quantity * plan.regularRate + plan.regularServiceCharge;
function summer(){
    return !aDate.isBefore(plan.summerStart) && !aData.isAfter(plan.summerEnd);
}
function summerCharge(){
    return quantity * plan.summerRate;
}
```

最后提炼条件判断为假的分支

```javascript
if (summer())
    charge = summerCharge();
else
    charge = regularCharge();
function summer(){
    return !aDate.isBefore(plan.summerStart) && !aData.isAfter(plan.summerEnd);
}
function summerCharge(){
    return quantity * plan.summerRate;
}
function regularCharge(){
    return quantity * plan.regularRate + plan.regularServiceCharge;
}
```

提炼完成之后，使用三元运算符重新安排条件语句

```javascript
charge = summer() ? summerCharge() : regularCharge();s
function summer(){
    return !aDate.isBefore(plan.summerStart) && !aData.isAfter(plan.summerEnd);
}
function summerCharge(){
    return quantity * plan.summerRate;
}
function regularCharge(){
    return quantity * plan.regularRate + plan.regularServiceCharge;
}
```

## 10.2 合并条件表达式（Consolidate Conditional Expression)

1. 名称

2. 一个简单的速写

```javascript
if (anEmployee.seniority < 2) return 0;
if (anEmployee.monthsDisabled > 12) return 0;
if (anEmployee.isPartTime) return 0;
```

重构为：

```javascript
if (isNotEligibleForDisability()) return 0;
function isNotEligibleForDisability(){
    return ((anEmployee.seniority < 2)
    	|| (anEmployee.monthsDisabled > 12)
    	|| (anEmployee.isPartTime));
}
```

3. 动机

当检查条件各不相同，最终行为却一致，可以使用“逻辑或”和“逻辑与”将它们合并为一个条件表达式。

4. 做法

- 确定这些条件表达式都没有副作用
- 使用适当的逻辑运算符，将两个相关条件表达式合并为一个
- 测试
- 重复前面的合并过程，直到所有相关的条件表达式都合并到一起
- 可以考虑对合并后的语句表达式实施提炼函数

5. 范例

- 范例一：

```javascript
function disabilityAmount(anEmployee){
    if (anEmployee.seniority < 2) return 0;
	if (anEmployee.monthsDisabled > 12) return 0;
	if (anEmployee.isPartTime) return 0;
}
```

将条件表达式进行合并

```javascript
function disabilityAmount(anEmployee){
    if ((anEmployee.seniority < 2)
        || (anEmployee.monthsDisabled > 12)
        || (anEmployee.isPartTime)) return 0;
}
```

对条件表达式使用提炼函数

```javascript
function disabilityAmount(anEmployee){
	if (isNotEligibleForDisability()) return 0;

	function isNotEligibleForDisability(){
    	return ((anEmployee.seniority < 2)
    		|| (anEmployee.monthsDisabled > 12)
    		|| (anEmployee.isPartTime));
	}
}
```

- 范例二：使用逻辑与

```javascript
if (anEmployee.onVacation)
    if (anEmployee.seniority > 10)
        return 1;
return 0.5;
```

使用逻辑与运算符将其合并

```javascript
if ((anEmployee.onVacation)
   && (anEmployee.seniority > 10)) return 1;
return 0.5;
```

## 10.3 以卫语句取代嵌套条件表达式（Replace Nested Conditional with Guard Clauses)

1. 名称

2. 一个简单的速写

```javascript
function getPayAmount(){
    let result;
    if (isDead)
        result = deadAmount();
    else {
        if (isSeparated)
            result = separatedAmount();
        else {
            if (isRetired)
                result = retiredAmount();
            else
                result = normalPayAmount();
        }
    }
    return result;
}
```

重构为：

```javascript
function getPayAmount(){
    if (isDead) return deadAmount();
    if (isSeparated) return separatedAmount();
    if (isRetired) return retiredAmount();
    return normalPayAmount();
}
```

3. 动机

4. 做法

- 选中最外层需要被替换的条件逻辑，将其替换为卫语句
- 测试
- 有需要的华，重复上述步骤
- 如果使用卫语句都引发同样的结果，可以使用合并表达式合并之

5. 范例

- 范例一：

```javascript
function payAmount(employee){
    let result;
    if (employee.isSeparated){
		result = {amount: 0, reasonCode: "SEP"};   
    }
    else {
        if (employee.isRetired){
            result = {amount: 0, reasonCode: "RET"};
        }
        else {
            lorem.ipsum(dolor.sitAmet);
            consectetur(adipiscing).elit();
            sed.do.eiusmod = tempor.incididunt.ut(labore) && dolore(magna.aliqua);
            result = someFinalComputation();
        }
    }
    return result;
}
```

先处理最顶上的条件逻辑

```javascript
function payAmount(employee){
    let result;
    if (employee.isSeparated) return {amount: 0, reasonCode: "SEP"};   
    if (employee.isRetired){
    	result = {amount: 0, reasonCode: "RET"};
    }
    else {
        lorem.ipsum(dolor.sitAmet);
        consectetur(adipiscing).elit();
        sed.do.eiusmod = tempor.incididunt.ut(labore) && dolore(magna.aliqua);
        result = someFinalComputation();
    }
    return result;
}
```

执行下一层

```javascript
function payAmount(employee){
    let result;
    if (employee.isSeparated) return {amount: 0, reasonCode: "SEP"};   
    if (employee.isRetired) return {amount: 0, reasonCode: "RET"};
    lorem.ipsum(dolor.sitAmet);
    consectetur(adipiscing).elit();
    sed.do.eiusmod = tempor.incididunt.ut(labore) && dolore(magna.aliqua);
    result = someFinalComputation();
    return result;
}
```

删除result变量

```javascript
function payAmount(employee){
    if (employee.isSeparated) return {amount: 0, reasonCode: "SEP"};   
    if (employee.isRetired) return {amount: 0, reasonCode: "RET"};
    lorem.ipsum(dolor.sitAmet);
    consectetur(adipiscing).elit();
    sed.do.eiusmod = tempor.incididunt.ut(labore) && dolore(magna.aliqua);
    return someFinalComputation();
}
```

范例二：将条件反转

```javascript
function adjustedCapital(anInstrument){
    let result = 0;
    if (anInstrument.capital > 0){
        if (anInstrument.insterestRate > 0 && anInstrument.duration > 0){
            result = (anInstrument.income / anInstrument.duration) * anInstrument.adjustmentFactor;
        }
    }
    retuen result;
}
```

逐一替换，不过在插入卫语句时将相应条件反转过来

```javascript
function adjustedCapital(anInstrument){
    let result = 0;
    if (anInstrument.capital <= 0) return result;
    if (anInstrument.insterestRate > 0 && anInstrument.duration > 0){
		result = (anInstrument.income / anInstrument.duration) * anInstrument.adjustmentFactor;
    }
    retuen result;
}
```

第二个条件语句比较复杂，分两步进行反转，先加入一个逻辑非操作

```javascript
function adjustedCapital(anInstrument){
    let result = 0;
    if (anInstrument.capital <= 0) return result;
    if (!(anInstrument.insterestRate > 0 && anInstrument.duration > 0)) return result;
	result = (anInstrument.income / anInstrument.duration) * anInstrument.adjustmentFactor;
    retuen result;
}
```

将逻辑非操作进行简化

```javascript
function adjustedCapital(anInstrument){
    let result = 0;
    if (anInstrument.capital <= 0) return result;
    if (anInstrument.insterestRate <= 0 || anInstrument.duration <= 0)) return result;
	result = (anInstrument.income / anInstrument.duration) * anInstrument.adjustmentFactor;
    retuen result;
}
```

两个条件的结果一样，可以进行合并

```javascript
function adjustedCapital(anInstrument){
    let result = 0;
    if (anInstrument.capital <= 0
        || (anInstrument.insterestRate <= 0 
        || anInstrument.duration <= 0) return result;
	result = (anInstrument.income / anInstrument.duration) * anInstrument.adjustmentFactor;
    retuen result;
}
```

移除result变量

```javascript
function adjustedCapital(anInstrument){
    if (anInstrument.capital <= 0
        || (anInstrument.insterestRate <= 0 
        || anInstrument.duration <= 0) return 0;
	return (anInstrument.income / anInstrument.duration) * anInstrument.adjustmentFactor;
}
```

















