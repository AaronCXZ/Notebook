## 事故响应

事故响应建立在使用监控构建地数据之上，并借助反馈循环，来帮助我们加强对服务的监控

### 什么是事故

事故是指一些重要的事情发生，它迫使你改变正常的行为

系统性的变化或系统运行环境的变化而引起的故障，通常是由于代码的部署或者系统操作的规模变化造成的

* 系统原因引起的事故
* 访问量增加引起的事故
* 数据库问题引起的事故

### 什么是事故响应

对发生的事故做出反应，通常包括

- 关注，注意到有些东西不对劲
- 交流，告诉别人哪些东西不对劲
- 恢复，纠正不对劲的东西

### 警报

#### 什么时候发起警报

- 我们对所有的警报都做出了适当的反应吗？如果我们接到警报，会在意吗？如果不是，那么应该改变警报，或者删除它，因为没有人对此做出反应
- 每一个警报都处于合适的程度吗？如果我们被一些无能为力的事情唤醒，这值得吗？我们是否该等到早上再去看呢？反之亦然——一个敏感的警报是否需要更加危急才能获得更直接的关注
- 应该保持警惕吗？警报占用接受者的时间，且往往会引起接受者肾上腺素剧增并打断一切。如果这个警告不重要，或者没有很好的利用我们的时间，理智起见，应该删除它
- 应该用什么方式去改变这个警报呢？也许警报的文本并没有告诉我们应该看什么，或者没有以一种人人都理解的方式来表达
- 希望得到警告的事情发生了吗？应该为应当看到却没有看到的东西制造新的警报吗？

警报和监控一样，都是不断变化的东西，不断的评估是不是必须的，才能确保警报是有用的并对它做出正确的反应

#### 怎么发出警报

通常的方式

- 电话
- 短信
- 专用的大声音的程序
- 群组的聊天消息
- 电子邮件
- 办公室里响亮的警报器

如何选择取决于警报的频率和数量，以及期望人们如何响应警报

#### 警报服务

多种方案，开源和付费

#### 警报内容

- 主题应该小于50个字符。这可以让接到警报的人快速了解情况
- 使用祈使句。当错误发生时人们常常希望给出有关如何操作的说明
- 子啊主题后面提供额外的注解。如果警报服务允许，警报内容应该包括实施细节，如图标或指标的评估，此外还应该包括对响应告警的人有用的文档的链接

#### 向谁发出警报

待命时间表

##### 随时待命

- 在决定向谁发出警报时，不要向所有人发出警报，除非目标对象只有不到3个人。如果每个人都提醒，等于没有提醒任何人
- 确保一个值班时间表，让人们知道什么时候待命
- 为处于待命状态的人提供后备支援者
- 创建一个明确的上报策略以供待命者遵循
- 上报策略对于其他团队也应该时清晰明确的
- 如果随机给团队中的一个人发消息，而不是他们的待命者，那么肯能得不到回应，或者得到一个错误的回应。如果有人找到你，而你不是所在团队的待命者，你应该将他们重新定向给正确的人，并告诉他们应该在那里寻找待命者，这样下次他们就能向正确的人善报了
- 界定一个人在待命期间的职责。只要包括他们还能正常开展工作吗？需要带着笔记本电脑或无线网络去旅行吗？可以接受的警报响应时间是多久？在警报或事故发生后，他们是否需要编写任何文档？还要明确待命者所负责的时间和问题的到解决的时间
- 给待命者更多的补偿。

### 沟通

- 无论如何你都应该每30分钟向所有相关人员发送一条消息，即使没有发生任何变化，也要告诉他们
- 还要在团队聊天中解释你正在做什么，以便人们能够协调操作，并且为日后保留日志
- 最好设置成两个频道，一个频道用于处理停机人员的讨论，另一个频道受事故影响的人员
- 在你被提醒并且试图弄清楚如何去解决之后，请确保持续和你的团队进行交谈，并且设定一个时间去寻求帮助

#### 事故指挥系统

沟通的一个重要方面是确定负责人

授权

#### 在哪里沟通

始终保持一致，并共享沟通所发生的位置

### 恢复系统

- 首先检查最近是否有部署。可以将错误与新版本进行对比，确认是否回滚到以前的版本
- 环境是否发生了改变。输入是否改变？是否开始接受大流量？收到一堆无意义或损坏的流量吗？是否开始阻止某个IP或者用户代理？这些是有效流量吗？是否可以横向扩展
- 依赖发生了改变。数据库准备好了吗？依赖的服务是否正常运行？是否有人在没告诉我们的情况下以不兼容的方式做了修改？

#### 警报解除

第一步是确保应用程序能够完成它该做的事情，然后就可以开始解决根本问题了。

第一目标是启动系统，而不是解决问题或找出根本原因。

两个单独的警报解除消息：

1. 事情恢复正常
2. 警报解除，并说明合适进一步通信

一旦验证了解决方案，然后发布一个更新说明事情已经解决了，并提及是否会有后续行动

在找到并修复中断的根本原因后，至少要再发布一次更新
