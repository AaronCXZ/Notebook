索引：保存一些额外的元数据作为路标，帮助你找到想要的数据。

存储系统的一个重要权衡：精心选择的索引加快了读查询的速度，但是每个索引都会拖慢写入速度。

哈希索引的策略：保留一个内存中的哈希映射，其中每个键都映射到一个数据文件中的字节偏移量，指明了可以找到对应值的位置。

##### 哈希索引数据库实施中重要的问题：

文件格式：使用二进制格式更快，更简单，首先已字节为单位对字符串的长度进行编码，然后使用原始字符串（不需要转义）。

删除记录：如果删除一个键及其关联的值，先在文件中附加一个特殊的删除记录即逻辑删除，当日志段被合并时，根据逻辑删除放弃被删除键的历史记录即物理删除。

崩溃恢复：如果数据库重启，原则上可以读取整个数据文件，但是可能会非常耗时。可以通过存储索引的哈希映射快照，更快的恢复。

部分写入记录：当记录附加到日志的中途崩溃时可以恢复

并发控制：由于写操作是以严格顺序的顺序附加到日志中的，所以常见的实现只有一个写入线程，但是可以被多个线程同时读取。

SSTables：排序字符串表，键值对的序列按键排序，每个键只在每个合并的段文件中出现一次

优势：

1. 合并段简单而高效
2. 不需要在内存中保存所有键的索引

SSTables存储引擎：

1. 写入时，将其添加带内存中的平衡树数据结构。这个内存树被称为内存表
2. 当内存表大于某个阈值时，将其作为SSTables文件写入磁盘。
3. 读取时，首先尝试从内存表中找到关键字，然后在最近的磁盘段中，然后在较旧的磁盘段中寻找关键字
4. 后台运行合并和压缩磁盘段的进程，完成丢弃覆盖或删除值。

问题：

1. 数据库崩溃时，最近写入的数据会丢失。为了避免这个问题，可以在磁盘上保存一个单独的日志，每个写入都会立即被附加到磁盘上，算是一个内存快照
2. 当查找数据库中不存在的键时会很慢，因为必须检查所有的存储文件，最后才能确定键不存在。为了优化访问，通常使用额外的Bloom过滤器(布隆过滤器)，可以判断数据库中是否出现键，从而节省读盘时间。

LSM存储引擎：基于合并和压缩排序文件原理的存储引擎

B树：将数据库分解成固定大小的块或页面，传统上大小为4K，并且一次只能读取或写入一个页面。每个页面都可以使用地址或位置来标识，允许一个页面引用另一个页面，类似指针，可以是用这些页面来构建一个页面树。一个页面会被指定为B树的根，在索引中查找一个键时就从根页面开始，改页面包含几个键和对子页面的引用，每个子页面负责一段连续范围的键。引用之间的键指明了引用子页面的键范围。

分支因子：在B树的一个页面中对子页面的引用数量

更新键：搜索该键的页面，更改页面中的值，并将更改写会带磁盘

添加键：找到其范围包含新键的页面，并将其添加带改页面。如果页面没有足够的空间容纳新键，则将其分成两个半满的页面，并更新父页面也解释键范围的新分区。